import createHttpError from 'http-errors';

export class CommonValidator {

    /**
     * Check if a color is in the proper hex format (with a # and 6 characters after it)
     * Ex: #FFFFFF
     * 
     * @param color a string representing a hex color to validate
     * @throws 400 if the color is not a valid hex color
     */
    static isValidHexColor(color: string): boolean {
        const hexColorPattern = /^#[0-9A-F]{6}$/i;
        return hexColorPattern.test(color);
    }

    /**
     * In order for a UUID to be valid in TypeORM and PostGres it must:
     * - Contain 32 characters
     * - Only contain hexidecimal values
     * - Be in the proper format: xxxxxxxx-xxxx-xxxx-xxxx-xxxx
     * 
     * This function will allow you to catch malformed UUID's to throw
     * a custom exception earlier in the code-path.
     * 
     * @param uuid The unique identifier to check
     */
    static isValidUUID(uuid: string): boolean {
        // Regex to test for: xxxxxxxx-xxxx-xxxx-xxxx-xxxx
        const UUID_REGEX = /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;
        return UUID_REGEX.test(uuid);
    }

    /**
     * Perform validation on a user identifier. This is generally used in
     * use cases when an identifier is a part of the request parameters
     * 
     * @param uuid The unique identifier auto generated by the database
     * @returns The UUID if it is valid
     * @throws 400 if the UUID is null
     * @throws 400 if the UUID is not a valid 
     */
    static validateUUID(uuid: string): string {
        if (!uuid) {
            throw createHttpError(400, 'ID required');
        }
        if (!CommonValidator.isValidUUID(uuid)) {
            throw createHttpError(400, 'ID is invalid');
        }
        return uuid;
    }
}